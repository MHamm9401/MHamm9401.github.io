<!DOCTYPE html>
<html lang="en">
  <!-- HEADING DOES NOT PRINT TO THE SCREEN -->
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="color-scheme" content="light dark" />
    <title>Moses Hamm • FDA Benchmark Nozzle Simulation </title>
    <meta name="description" content="Projects collection" />
    <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>

    <!-- Pico.css -->
    <link
      rel="stylesheet" 
      href="https://cdn.jsdelivr.net/npm/@picocss/pico@2.0.6/css/pico.min.css"
    />

    <style>
    img {
      display: block;
      margin-left: auto;
      margin-right: auto;
    }
    </style>    
  </head>

  <body>
    <!-- Header -->
    <header class="container">
      <hgroup>
        <h1>Moses Hamm • Projects</h1>
        <p>To view the entire collection of simulation, coding, and physical projects, click <a href="/index.html">here</a>. 
          For questions, contact me at hammmj@purdue.edu or <a href="https://www.linkedin.com/in/moses-hamm">www.linkedin.com/in/moses-hamm</a>!
        </p>
      </hgroup>
    </header>
    <!-- ./ Header -->
    
    <!-- Main -->
    <main class="container">
      <!-- FSI Overview -->
      <section id="preview">
        <h2>FDA Benchmark Nozzle Simulation</h2>
        <p>
          In this project, I simulated blood flow through the FDA benchmark nozzle and compared simulation results to experimental results obtained  
          in <a href="https://link.springer.com/article/10.1007/s13239-012-0087-5#Sec9">Stewart et al</a>.
        </p>
      </section>
      <!-- ./ FSI Overview -->

      <!-- Motivation-->
      <section id="motivation">
        <h3>Background</h3>
        <p>
          Per the <a href="https://www.fda.gov/medical-devices/science-and-research-medical-devices/benchmark-dataset-validating-computational-fluid-dynamic-cfd-simulation-blood-flow-through">FDA</a>:
          "The FDA benchmark nozzle can be used as an early-stage validation of computational fluid dynamic (CFD) models simulating blood flow through blood 
          contacting devices with comparable geometry and flow features. The early-stage validation is limited 
          to velocity and pressure data within the benchmark geometries. The tool provides validation data (pressure and velocity field) obtained from 
          inter-laboratory bench experiments within a generic and simplified nozzle geometry. Modelers can use the pressure and velocity validation data 
          to perform early-stage validation of their computational fluid dynamics (CFD) model/software before performing any device-specific verification,
          validation, and credibility assessment."
        </p>
      </section>

      <!-- Motivation-->
      <section id="motivation">
        <h3>Objective</h3>
        <p>
          The objective of this CFD analysis is to provide:
          <ul>
            <li>qualitative descriptions of flow through the FDA benchmark nozzle at Re=6500</li>
            <li>qualitative comparisons to experimental data </li>
            <li>quantitative steady-state results in the form of pressure drop across the nozzle and jet velocity</li>
          </ul> 
        </p>
      </section>

      <!-- Geometry-->
      <section id="geometry">
        <h3>Geometry</h3>
        <p>
          The FDA nozzle (shown below) consists of an initial section with diameter 12mm, a taper region, a throat with diameter 4mm, and a sudden expansion 
          back to 12mm. Details of the entrance/exit lengths were left up to modelers.  
        </p>

        <figure>
          <img
            src="https://MHamm9401.github.io/figures/geometry.jpg"
            width="66%"
            class="center" 
          />
        </figure>
        
        <p>
          To prepare the geometry for simulation, three edits were made. First, the geometry was cut in half axially to take advantage of its symmetry. 
          Next, the 90 degree corners at the sudden expansion were chamfered with a radius of 0.2mm to aid in meshing. Last, the entrance and exits were 
          extended to a distance of \(10D_{max}\) to allow flow profiles to develop and minimize artifacts due to the boundary conditions. 
        </p>
      </section>

      <!-- Mesh>
      <section id="mesh">
        <h3>Meshing</h3>
        <p>
          An unstructured all-quad mesh with edge lengths of 1.5e-4m and 25 inflation layers was generated using the Multizone Quad method and Inflation tool 
          in Ansys Meshing.
          To obtain the appropriate first layer height and total height of the inflation layer, the physical boundary layer height and target y+ values 
          at the nozzle throat were estimated using a Reynolds number of 5000. The displacement height of the flow was calculated using the formula for bounded
          turbulent flows: 
          \[\delta(x) = 1.72\sqrt{\frac{\mu x}{\rho u_{avg}}}\]
          yielding a value of approximately 3e-4m. Therefore, the BL was generated with a total height greater than 3e-4m to ensure total capture of the 
          boundary layer. A target value for y+ was set at 1 to adequately capture the viscous sub-layer of the boundary layer. In theory, the formula
          \[y^{+} = \frac{\rho y u}{\mu}\] 
          can be used to calculate the first layer height. In practice, the first layer was refined iteratively until the target y+ was reached. A summary of
          the final inflation layer settings is shown below. 

        <figure>
          <img
            src="https://MHamm9401.github.io/figures/inflation_settings.png"
            width="40%"
            class="center"
          />
        </figure>

          The final mesh contained approximately 116k cells. A representative image of the mesh at the throat and sudden expansion is shown below. 
          
        <figure>
          <img
            src="https://MHamm9401.github.io/figures/mesh.png"
            width="66%"
            class="center"
          />
        </figure>
      </section>

      
      <!-- BCs-->
      <section id="boundaries">
        <h3>Boundary Conditions</h3>
        <ul>
          <li>Inlet: velocity inflow of 0.4607m/s and 5% turbulence intensity </li>
          <li>Outlet: zero-pressure outlet </li>
          <li>Walls: no-slip </li>
          <li>Axis: axisymmetry </li>
          <li>Fluid: incompressible blood analog with density 1056 kg/m^3 and viscosity 3.5 cP</li>
        </ul>
      </section>

      <!-- BCs-->
      <section id="Equations">
        <h3>Physical Models Used</h3>
        <ul>
          <li>Spatial: 2D axisymmetric </li>
          <li>Temporal: steady-state </li>
          <li>Equations: Reynolds Averaged Navier-Stokes (RANS) </li>          
          <li>Turbulence Model: \(SST k-\omega\)  (RANS) </li> 
          <li>Fluid: incompressible blood analog with density 1056 kg/m^3 and viscosity 3.5 cP</li>
        </ul>
      </section>

      <!-- Solver-->
      <section id="solver">
        <h3>Solver Settings </h3>
        <p>
          The steady-state, pressure-based solver was used as the fluid is incompressible. In addition, the following discretization and PV coupling methods
          were used:
        </p>
        <figure>
          <img
            src="https://MHamm9401.github.io/figures/settings.png"
            width="25%"
            class="center"
          />
        </figure>
      </section>

      <!-- Results-->
      <section id="results">
        <h3>Iterative Convergence</h3>
        <p>
          The simulation was considered well-converged based on the following criteria: 
        <ul>
          <li>continuity, velocity, and turbulence residuals dropped five orders of magnitude</li>

        <figure>
          <img
            src="https://MHamm9401.github.io/figures/residuals.png"
            width="66%"
            class="center"
          />
        </figure>
          
          <li>Monitored variables (pressure drop and jet velocity) converged to physically reasonable values.</li>
        <figure>
          <img
            src="https://MHamm9401.github.io/figures/pressure_monitor.png"
            width="66%"
            class="center"
          />
        </figure>
        
        <figure>
          <img
            src="https://MHamm9401.github.io/figures/velocity_monitor.png"
            width="66%"
            class="center"
          />
        </figure>
        </ul>  
        </p>
      </section>
      
      <!-- Results-->
      <section id="results">
        <h3>Grid Convergence</h3>
        <p>
          A grid convergence study using four meshes was performed at Re=5000 as per the methods section of Stewart et al. All meshes shared the 
          same inflation layer, and the body mesh sizing was varied 
          such that the number of elements roughly doubled with each level of refinement. The edge length and element count for each mesh were: 
        <ul>
          <li>Coarse: 3e-4m (42k elements)</li>
          <li>Medium: 1.5e-4m (117k elements)</li>
          <li>Fine: 1e-4m (220k elements)</li>
          <li>Finest: 7.5e-5m (360k elements)</li>
        </ul>
          The axial velocity at the centerline was plotted for each case to assess qualitative convergence. 
        <figure>
          <img
            src="https://MHamm9401.github.io/figures/axial_vel_grid.png"
            width="66%"
            class="center"
          />
        </figure>
        In addition, the overall pressure drop and maximum jet velocity were calculated for each mesh and compared to the finest grid. A convergence 
        criteria of 2% was used to quantitatively assess convergence. 

        <figure>
          <img
            src="https://MHamm9401.github.io/figures/table_error.png"
            width="66%"
            class="center"
          />
        </figure>
        </ul>  
        </p>
      </section>
      
      <!-- Verification-->
      <section id="verification">
        <h2>Verification</h2>
        <p>
          Two code verification activities were undertaken. 
          <ol type="1">
            <li>Wall tracking verification</li>
            <li>Continuity verification </li>
          </ol>
        </p>
      </section>
      
      <!-- Verification-->
      <section id="track_verification">
        <h3>Wall Tracking Verification</h3>
        <p>
          Before coding the physics of the moving wall, verification of the wall tracking was performed. There were three parameters of interest: 
          <ol type="1">
            <li>Wall position</li>
            <li>Wall index </li>
            <li>Wall fraction </li>
          </ol>
        A simulation was run until the wall advanced approximately 1m into the domain. Afterwards, the calculated wall position was evaluated 
        to ensure it matched hand calculations based on the time and velocity. <br>
        <figure>
          <img
            src="https://MHamm9401.github.io/figures/initial_condition_4300.png"
            width="640"
            height="480"
            class="center"
          />
        </figure>

        
        <br>
        The wall index calculated by the code was compared to hand calculations and plotted to ensure that a pattern of repeated step functions occurred. 
        Finally, the wall index was compared to hand calculations and plotted to ensure that it was bounded between 0 and 1. <br>
        <figure>
          <img
            src="https://MHamm9401.github.io/figures/wall_tracker.png"
            width="630"
            height="475"
            class="center"
          />
        </figure>
        </p>
      </section>
      
      <!-- Verification-->
      <section id="COM_verification">
        <h3>Continuity Verification</h3>
        <p>
          After completing the physics of the moving wall, simulations were run and conservation of mass was verified by multiplying the sum of the density by the instantaneous 
          effective volume of the piston. On the first iteration of the boundary condition, the piston lost a significant amound of mass as shown below. <br>
        <figure>
          <img
            src="https://MHamm9401.github.io/figures/CoM_noFluxBC.png"
            width="630"
            height="475"
            class="center"
          />
        </figure>
          This led to the addition of a Neumann mass flux condition to enforce conservation of mass. After this addition, continuity was signficantly 
          improved. However, when the wall enters a new cell, there is still some change in the mass of the system. 
          Overall, there is a transient spike in mass, but the mass then levels out and remains stable, as shown below. 
          <figure>
          <img
            src="https://MHamm9401.github.io/figures/CoM_withFluxBC.png"
            width="630"
            height="475"
            class="center"
          />
        </p>
      </section>

      <!-- Validation-->
      <section id="validation">
        <h2>Validation</h2>
        <p>
          In a piston, it is important to be able to accurately predict the pressure and volume of the system. 
          Therefore, the pressure-volume term of the ideal gas law was chosen as a validation quantity. Neglecting heat transfer, PV is a 
          constant in an ideal gas system. 
          <ul>
            <li>Initial: P = 101,000Pa V = 4m^2, PV = 404,000J</li>
            <li>Final: P = 124,531Pa V = 3.04m^2, PV = 378,574J</li>
            <li>Error of approximately 6.5% in quantity of interest</li>
          </ul> 
          While there is a lot of room for improvement, a prediction within 10% may be useful in a quick-and-dirty analysis. 
        </p>
      </section> 
    </main>
    <!-- ./ Main -->
  </body>

  
</html>
